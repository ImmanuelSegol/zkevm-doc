% !TeX document-id = {5c581797-4493-4c49-83e2-2f6935aa95ee}
% !TeX TXS-program:compile = txs:///xelatex/[--shell-escape]
% !TeX spellcheck = en_US

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%% BEGIN OF HEAD %%%%%%%%%%%%%%%%%%%

%\documentclass[10pt,english,aspectratio=169]{beamer} % With animations
\documentclass[10pt,english,handout,aspectratio=169]{beamer} % Without animations (for printing)
\setbeamertemplate{theorems}[numbered] % To number theorems, lemmas, definitions...

\usetheme[numbering=fraction,progressbar=frametitle,block=fill,subsectionpage=progressbar]{metropolis}

% For the code, so it looks like real code
\usepackage{fontspec}
\setmonofont{Iosevka Term}

\newfontfamily\DejaSans{DejaVu Sans} %Emojis

% https://tex.stackexchange.com/questions/60360/how-to-use-fraktur-gothic-fonts-in-text-mode
\usepackage{yfonts} %Gothic Font e.g., \textgoth{}
\usepackage{mathrsfs} %Used for super caligraphic font \mathscr{}

% Footnote size
\setbeamerfont{footnote}{size=\tiny} 

% Animation transparent
\setbeamercovered{transparent}

% To import Inkscape figures
\usepackage{import}
\usepackage{pdfpages}
\usepackage{transparent}
\usepackage{xcolor}

% To create an appendix
\usepackage{appendixnumberbeamer}

% Metropolis dependences
\usepackage{etoolbox}
\usepackage{ifxetex}
\usepackage{pgfopts}
\usepackage{calc}
\usepackage{ifluatex}

% Tikz Library
% https://www.iacr.org/authors/tikz/
\usepackage{tikz}
\usetikzlibrary{shapes.callouts,calc, arrows, positioning, matrix, intersections, decorations.markings}
\tikzset{point/.style={draw,fill,circle,inner sep=1pt}}
\tikzset{vertex/.style = {shape=circle,draw,minimum size=1.5em}}
\tikzset{line/.style = {-}}
\tikzset{arrow/.style = {->}}

\newcommand{\plotcurve}[4][thick, every plot/.style={smooth}]{
  % plot curve y^2 = x^3 + a x + b in range [-#4,#4]^2
  % parameter 1 (optional): style options for curve (color, etc)
  % parameter 2: curve parameter a
  % parameter 3: curve parameter b
  % parameter 4: range to print
  % \draw[gray] (-3,-3) rectangle (3,3);
  \draw[->,>=latex,gray] (-#4,0) -- (#4,0);
  \draw[->,>=latex,gray] (0,-#4) -- (0,#4);
  \draw[name path=curve, #1] plot[id=curve#2#3, raw gnuplot] function {
    f(x,y) = y**2 - x**3 - #2*x - #3;
    set xrange [-#4:#4];
    set yrange [-#4:#4];
    set view 0,0;
    set isosample 50,50;
    set contour base;
    set cntrparam levels incre 0,0.1,0;
    unset surface;
    splot f(x,y);
  };
}

% For an explanation of the tangent coordinate system, check http://tex.stackexchange.com/a/25940 
\tikzset{
  tangent/.style={
    decoration={markings, mark=at position #1 with {
      \coordinate (tangent point-\pgfkeysvalueof{/pgf/decoration/mark info/sequence number}) at (0pt,0pt);
      \coordinate (tangent unit vector-\pgfkeysvalueof{/pgf/decoration/mark info/sequence number}) at (1,0pt);
      \coordinate (tangent orthogonal unit vector-\pgfkeysvalueof{/pgf/decoration/mark info/sequence number}) at (0pt,1);
    }},
    postaction=decorate
  },
  use tangent/.style={
    shift=(tangent point-#1),
    x=(tangent unit vector-#1),
    y=(tangent orthogonal unit vector-#1)
  },
  use tangent/.default=1
}

% Alternative to tikz
\usepackage{pgfplots}
\pgfplotsset{compat=newest}

% This package controls how hyperlinks are displayed
% https://es.overleaf.com/learn/latex/Hyperlinks
\usepackage{hyperref}
\hypersetup{colorlinks=true,linkcolor={red!80!black},urlcolor={blue!80!black}}

% A better version of the proof environtment for beame
% The optional parameter is though to be "of Lemma \ref{ref-to-the-lemma}" or "of Theorem \ref{ref-to-the-theorem}"
\renewenvironment{proof}[1][\unskip]{\textbf{Proof #1:} \vspace{1mm} \hrule \vspace{1mm}}{\hfill$\qed$ \vspace{1mm} \hrule \vspace{1mm}}

% Benaloh Brackets
\usepackage{stmaryrd}

% Quotes: \enquote
\usepackage{csquotes}

% Cancel out math
\usepackage{cancel}

%This ensures spaces when using ensuremath and no $$ are used to introduce math
\usepackage{xspace}

% Working directory
\newcommand{\definedir}[2]{\newcommand{#1}{#2}}
\definedir{\zkevmdir}{..}

% Path relative to the main .tex file 
%\graphicspath{{\dir/figures/}}
%
%\newcommand{\incfig}[2][1]{%
%	\def\svgwidth{#1\columnwidth}
%	\import{\dir/figures/}{#2.pdf_tex}
%}

% Table of contents configuration
\AtBeginSection[]
{
\begin{frame}
	\setcounter{tocdepth}{1} %show only up to section
	\frametitle{Table of Contents}
  \hypersetup{linkcolor=.}
	\tableofcontents[currentsection,
		sectionstyle=show/shaded] %currentSection/anotherSections
\end{frame}
}

\AtBeginSubsection[]
{
\begin{frame}
	\setcounter{tocdepth}{2} %show only up to subsection
	\frametitle{Table of Contents}
  \hypersetup{linkcolor=.}
	\tableofcontents[currentsection,
        currentsubsection,
		sectionstyle=show/shaded, %currentSection/anotherSections
        subsectionstyle=show/shaded/hide]
		%currentSubSeciont - currentSection/
		%anotherSubSeciont - currentSection/
		%SubSeciont - anotherSection
\end{frame}
}

%%%%%%%%%%%%%%%%%%% END OF HEAD %%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%% BEGIN OF LSTLISTINGS %%%%%%%%%%%%%%%

\usepackage{showexpl}% already includes listings package
% The listings package defines an internal command for replacements within filenames. 
% One of these replacements replaces - with \textendash. 
% You can redefine this command to make the hyphens actual hyphens:
\makeatletter
\def\lst@filenamerpl{_\textunderscore $\textdollar}
\makeatother
\lstset{
	frame=shadowbox, 
	basicstyle=\footnotesize\ttfamily, 
	showstringspaces=false,
	rulesepcolor=\color{black}, 
	upquote=true
}
% \lstset{language=bash, frame=shadowbox, basicstyle=\footnotesize, showstringspaces=false,
% rulesepcolor=\color{black}, upquote=true, }
\lstdefinestyle{scriptStyle}{
	basicstyle=\footnotesize,% control font of code
	preset=\footnotesize,% adjust font size of output
	numbers=left, numberstyle=\tiny, stepnumber=1, numbersep=5pt,
	frame=tlbr,
	pos=r,% want output on rightbackgroundcolor=\color{yellow!30},
	width=0.50\linewidth,
}

\lstdefinestyle{terms}{
	basicstyle=\scriptsize\ttfamily,% control font of code
	preset=\footnotesize,% adjust font size of output
}

\lstdefinestyle{termt}{
	basicstyle=\tiny\ttfamily,% control font of code
	preset=\footnotesize,% adjust font size of output
}

\lstdefinestyle{verb}{
	basicstyle=\footnotesize,% control font of code
	preset=\footnotesize,% adjust font size of output
	frame=tlbr,
	pos=r,% want output on right
	%     backgroundcolor=\color{yellow!30},
	width=0.50\linewidth,
}

\lstdefinestyle{verbs}{
	basicstyle=\scriptsize,% control font of code
	preset=\scriptsize,% adjust font size of output
	frame=tlbr,
	pos=r,% want output on right
	%     backgroundcolor=\color{yellow!30},
	width=0.50\linewidth,
}

\lstdefinestyle{verbt}{
	basicstyle=\tiny\ttfamily,% control font of code
	preset=\tiny\ttfamily,% adjust font size of output
	frame=tlbr,
	pos=r,% want output on right
	%     backgroundcolor=\color{yellow!30},
	width=0.50\linewidth,
}

%%%%%%%%%%%%%%%%% END OF LSTLISTINGS %%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%% BEGIN OF CODE HIGHLIGHTING ENVIRONMENTS %%%%%%

%   sudo apt install texlive-latex-extra 
%   sudo apt install python-pip
%   pip install pygments
%   pip install pygments-lexer-babylon  #contains JSX
%   pip install pygments-lexer-solidity 
%   pip install pygments pygments-lexer-babylon pygments-lexer-solidity



\usepackage{tcolorbox}
\tcbuselibrary{minted,skins,listings}
\definecolor{mybg}{rgb}{0.96,0.96,0.98}

\newtcblisting{term}{
	listing engine=minted,
	colback=black,
	colframe=black!0,
	coltext=white,
	listing only,
	minted style=tango,
	minted language=text,
	minted options={linenos=false,texcl=true},
	left=0mm, top=0mm, bottom=0mm, right=0mm,
	boxrule=0mm
}

\newtcblisting{js}{
	listing engine=minted,
	colback=mybg,
	colframe=black!30,
	listing only,
	minted style=tango,
	minted language=js,
	minted options={linenos=false,texcl=true},
	left=0.2mm,
	top=0cm,
	bottom=0cm,
	boxrule=0.1mm
}

\newtcblisting{ts}{
	listing engine=minted,
	colback=mybg,
	colframe=black!30,
	listing only,
	minted style=tango,
	minted language=ts,
	minted options={linenos=false,texcl=true},
	left=0.2mm,
	top=0cm,
	bottom=0cm,
	boxrule=0.1mm
}

\newtcblisting{solidity}{
	listing engine=minted,
	colback=mybg,
	colframe=black!70,
	listing only,
	minted style=tango,
	minted language=solidity,
	minted options={linenos=false,texcl=true,fontsize=\tiny},
	left=0.2mm,
	top=0cm,
	bottom=0cm,
	boxrule=0.1mm
}

\newtcblisting{sql}{
	listing engine=minted,
	colback=mybg,
	listing only,
	minted style=tango,
	minted language=sql,
	minted options={linenos=false,texcl=true},
	left=0.2mm,
	top=0cm,
	bottom=0cm,
	colframe=black!30,
	boxrule=0.1mm
}

%%%%%%% END OF CODE HIGHLIGHTING ENVIRONMENTS %%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%% BEGIN OF MACROS %%%%%%%%%%%%%%%%%%%

% Cryptocode: https://github.com/arnomi/cryptocode
% You have to update the package manually by downloading the latest ".sty" in the link above and then:
% sudo mv ~/cryptocode.sty usr/share/texlive/texmf-dist/tex/latex/cryptocode
\usepackage[
lambda,
operators,
landau, %este es el de bigO
probability,
%sets,
logic, %para or,and...	
asymptotics,
keys
]{cryptocode}

% My own procedure blocks to show protocols
\createprocedureblock{mypb}{center, boxed}{}{}{linenumbering}
\createprocedureblock{mypbnonum}{center, boxed}{}{}{}

% Numbering style
\renewcommand{\pclnstyle}[1]{\text{#1}}
\renewcommand{\pclnseparator}{.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Hyphen inside mathmode
\mathchardef\mhyphen="2D

% Bold Math
\renewcommand{\vec}[1]{\ensuremath{\boldsymbol{#1}}\xspace}
\newcommand{\vel}[3]{\ensuremath{\vec{#1_{#2}}(#3)}\xspace}

% Mathbb
\renewcommand{\AA}{\ensuremath{\mathbb{A}}\xspace}
\newcommand{\CC}{\ensuremath{\mathbb{C}}\xspace}
\newcommand{\FF}{\ensuremath{\mathbb{F}}\xspace}
\newcommand{\GG}{\ensuremath{\mathbb{G}}\xspace}
\newcommand{\KK}{\ensuremath{\mathbb{K}}\xspace}
\newcommand{\NN}{\ensuremath{\mathbb{N}}\xspace}
\newcommand{\PP}{\ensuremath{\mathbb{P}}\xspace}
\newcommand{\QQ}{\ensuremath{\mathbb{Q}}\xspace}
\newcommand{\RR}{\ensuremath{\mathbb{R}}\xspace}
\newcommand{\ZZ}{\ensuremath{\mathbb{Z}}\xspace}

% Mathcal
\newcommand{\B}{\ensuremath{\mathcal{B}}\xspace}
\renewcommand{\C}{\ensuremath{\mathcal{C}}\xspace}
\newcommand{\E}{\ensuremath{\mathcal{E}}\xspace}
\renewcommand{\H}{\ensuremath{\mathcal{H}}\xspace}
\newcommand{\I}{\ensuremath{\mathcal{I}}\xspace}
\newcommand{\K}{\ensuremath{\mathcal{K}}\xspace}
\newcommand{\M}{\ensuremath{\mathcal{M}}\xspace}
\renewcommand{\O}{\ensuremath{\mathcal{O}}\xspace}
\renewcommand{\P}{\ensuremath{\mathcal{P}}\xspace}
\newcommand{\Q}{\ensuremath{\mathcal{Q}}\xspace}
\newcommand{\R}{\ensuremath{\mathcal{R}}\xspace}
\renewcommand{\S}{\ensuremath{\mathcal{S}}\xspace}
\newcommand{\T}{\ensuremath{\mathcal{T}}\xspace}
\newcommand{\V}{\ensuremath{\mathcal{V}}\xspace}
\newcommand{\X}{\ensuremath{\mathcal{X}}\xspace}

% Mathscr
\newcommand{\CCC}{\ensuremath{\mathscr{C}}\xspace}
\newcommand{\PPP}{\ensuremath{\mathscr{P}}\xspace}

% Mathfrak
\newcommand{\z}{\ensuremath{\mathfrak{z}}\xspace}

% Caligraphic Combiantions
\DeclareMathAlphabet{\mathpgoth}{OT1}{pgoth}{m}{n}
\newcommand{\plonk}{\ensuremath{\mathcal{P}\mathfrak{lon}\mathcal{K}}\xspace}
\newcommand{\fflonk}{\ensuremath{\mathcal{FF}\mathfrak{lon}\mathcal{K}}\xspace}
\newcommand{\plookup}{\ensuremath{\mathpgoth{plookup}}\xspace}

% Abbreviations
\newcommand{\eqstackrel}[2]{\ensuremath{\stackrel{\substack{\mathclap{#2}\\[0.5ex]\displaystyle\uparrow\\ ~}}{#1}}\xspace} %this is used to justify any symbol #1
\newcommand{\Pp}{\ensuremath{\mathcal{P}_{\mathsf{poly}}}\xspace}
\newcommand{\Vp}{\ensuremath{\mathcal{V}_{\mathsf{poly}}}\xspace}
\newcommand{\MR}{\ensuremath{\mathsf{MR}}\xspace}
\renewcommand{\deg}{\ensuremath{\mathsf{deg}}\xspace}
\newcommand{\inp}{\ensuremath{\mathsf{in}}\xspace}
\newcommand{\set}{\ensuremath{\mathsf{set}}\xspace}
\newcommand{\op}{\ensuremath{\mathsf{op}}\xspace}

% Symbols over arrows
\newcommand{\eqI}{\ensuremath{\overset{?}{=}}\xspace}
\newcommand{\leftR}{\ensuremath{\leftarrow_R}\xspace}

% Operator abreviattion
\renewcommand{\gcd}{\ensuremath{\mathsf{gcd}}\xspace}
\renewcommand{\max}{\ensuremath{\mathsf{max}}\xspace}
\renewcommand{\log}{\ensuremath{\mathsf{log}}\xspace}
\newcommand{\lcm}{\ensuremath{\mathsf{lcm}}\xspace}
\renewcommand{\mod}[1]{\ensuremath{~(\mathsf{mod}~#1)}\xspace}
\newcommand{\Mod}[1]{\ensuremath{~\mathsf{mod}~#1}\xspace}
\newcommand{\legendre}[2]{\ensuremath{\left(\frac{#1}{#2}\right)}\xspace}
\newcommand{\Bracket}[1]{\ensuremath{\left[#1\right]}\xspace}
%\newcommand{\Bracket}[1]{\ensuremath{\llbracket#1\rrbracket}\xspace} %Benaloh Bracket

%Name of a function: ensuremath and xspace does not work for them
\DeclareMathOperator{\DFT}{DFT} 
\DeclareMathOperator{\PI}{PI} 

% Make a nice emptyset
\let\oldemptyset\emptyset
\let\emptyset\varnothing

% Make a nice phi
\let\oldphi\phi
\let\phi\varphi
	
% Make a nice q.e.d. symbol
\renewcommand\qedsymbol{\ensuremath{\blacksquare}\xspace}

%%%%%%%%%%%%%%%%%%% END OF MACROS %%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%$$$$$$$$$$$         TITLE PAGE	     %%$$$$$$$$$$$ 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%$$$$$$$$$$$             ||             %%$$$$$$$$$$$
%%$$$$$$$$$$$             ||             %%$$$$$$$$$$$
%%$$$$$$$$$$$             \/             %%$$$$$$$$$$$


% Titlepage
\title{Zero Knowledge Ethereum Virtual Machine}
%\subtitle{Subtitle}
\author{\textbf{Jordi Baylina ~~~ Héctor Masip-Ardevol ~~~ Jose L. Muñoz-Tapia}}
\institute{Polygon-Hermez \\ Information Security Group, Universitat Politècnica de Catalunya (UPC)}
\date{\today}
\titlegraphic{\includegraphics[height=1.5cm]{logos/hermez} 
\hfill \includegraphics[height=1.5cm]{logos/upc}
}

% Change default options for the titlepage
\setbeamertemplate{date}{
	\raggedleft%
	\raggedbottom%
	\vspace*{2mm}
	%\insertdate% %Uncomment this line to add the date
	\par%
}

%Uncomment this command to add the date
%\setbeamertemplate{institute}{
%	\vspace*{-3mm}
%	\insertinstitute%
%	\par%
%}


%%$$$$$$$$$$$             /\             %%$$$$$$$$$$$
%%$$$$$$$$$$$             ||             %%$$$$$$$$$$$
%%$$$$$$$$$$$             ||             %%$$$$$$$$$$$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%$$$$$$$$$$$         TITLE PAGE	     %%$$$$$$$$$$$ 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%% SOME USEFUL LATEX %%%%%%%%%%%%%%%%%%%

% Web for icons: https://www.flaticon.com/

% Fragile is necessary for showing code
%\begin{frame}[fragile]{}
%\end{frame}

%\begin{figure}[ht]
%	\centering
%	\incfig{}
%\end{figure}

%\begin{figure}
%	\includegraphics[width=\textwidth]{}
%\end{figure}

%\[
%\begin{array}{|c|c|c|}
%\multicolumn{number of columns}{align}{text} \\ \hline
%\hline
% & & \\ \hline
% & & \\ \hline
%\end{array}
%\]

%\begin{overprint}
%	\onslide<1>\centering
%	\includegraphics[width=\textwidth]{}
%\end{overprint}	

%\begin{columns}
%\begin{column}{0.5\textwidth}
%\end{column}
%\begin{column}{0.5\textwidth}
%\end{column}
%\end{columns}

% For smaller procedure block size
%\begin{pchstack}[boxed, center]
%\pcsetargs{codesize=\scriptsize{}}
%
%\procedure{}{}
%\end{pchstack}

%For repeating a slide
%\begin{frame}[label=test]
%\againframe{test}

% To number only some lines of align
%\begin{align}
%eq1 \nonumber \\
%eq2 \label{eq:eq-2}
%\end{align}

% To color something
% https://es.overleaf.com/learn/latex/Using_colours_in_LaTeX
%{\color{red!80!black} text}

% Function definition
%\begin{align*}
%f \colon \FF_p &\to \FF_p \\
%x &\mapsto x^k.
%\end{align*}

\begin{document}
	
\maketitle
	
\begin{frame}{Table of Contents}
  \hypersetup{linkcolor=.}
	\tableofcontents
\end{frame}
	
\input{\zkevmdir/architecture/latex/introduction}
\input{\zkevmdir/architecture/latex/microVM-architecture}
\input{\zkevmdir/architecture/latex/main-state-machine}
	
\end{document}